To assemble the webappshell we:

1. Make the webappshell directory
2. Copy BIN/greprefs.js to it
3. Create a chrome.manifest that is identical to Firefox, but with WebappShellComponents.manifest instead of BrowserComponents.manifest and with "content webapp content/"", and then remove the "manifest chrome/browser.manifest" line from it.
4. cd into components, copy BrowserComponents.manifest and rename it WebappShellComponents.manifest, and then change all the GUIDs in it to our new GUID.
5. symlink the chrome, components, modules, and res directories
6. copy the content directory from browser/app/webapp to it
7. copy BIN/defaults to it, and rename defaults/pref/firefox.js to defaults/pref/webappshell.js; then change the chromeURL and hiddenWindowChromeURL of to chrome://webapp/content/window.xul and chrome://webapp/content/hiddenWindow.xul
8. Some set of other things need to be symlinked for plugins to work.  I am not sure what the set of these is; if you do all of them it works.